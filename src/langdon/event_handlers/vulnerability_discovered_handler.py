from __future__ import annotations

from typing import TYPE_CHECKING

from langdon.models import Vulnerability
from langdon.utils import create_if_not_exist

if TYPE_CHECKING:
    from langdon.events import VulnerabilityDiscovered
    from langdon.langdon_manager import LangdonManager


def handle_event(event: VulnerabilityDiscovered, *, manager: LangdonManager) -> None:
    create_if_not_exist(
        Vulnerability,
        defaults={"source": event.source},
        technology_id=event.technology.id,
        manager=manager,
        name=event.name,
    )
